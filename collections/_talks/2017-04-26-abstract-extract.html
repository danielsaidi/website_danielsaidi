---
title: Abstract, Extract
date: 2017-04-26
location: Lifesum, Stockholm
location_url: https://lifesum.com/sv/

abstract: |
  I gave this talk at Lifesum in 2017, on how to retake control over
  code that has grown unmaintainable, and how some common
  code smells can help you detect code-related problems in time.
---

{% capture assets %}{{ "assets/talks/170426" | relative_url }}{% endcapture %}


<section data-markdown class="title-page">
  # Abstract, Extract
  ## Lifesum, Stockholm
  ### April 2017
  
  Daniel Saidi · [@danielsaidi]({{site.twitter_url}})
</section>


<section>
  <section data-markdown>
    # Daniel Saidi
    ### iOS Lead @ BookBeat
  </section>

  <section data-markdown>
    <script type="text/template">
    ## Before that
    * .NET
    * Web
    * Android
    * Java, Python, C / C++
    </script>
  </section>

  <section data-markdown class="image-section" data-background="{{assets}}/cool.gif">
    # Windows Mobile 2005
    ## Before it was cool
  </section>

  <section data-markdown>
    <script type="text/template">
    # Previous roles
    * .NET Developer
    * System Architect
    * Lead Developer
    * Head of Mobile
    </script>
  </section>

  <section data-markdown class="image-section" data-background="{{assets}}/team-yellow.jpg">
    # Team Yellow
    ## With Mariah ❤️
  </section>
</section>

<section>

  <section data-markdown>
    # So why am I here?
  </section>

  <section data-markdown>
    # Code quality
    * Very important to me (too important)
    * Constant work in progress
    * ...and yet, I often suck at it
    * Strange how hard the easy is
  </section>

  <section data-markdown class="image-section" data-background="{{assets}}/rube.png">
  </section>

  <section data-markdown>
    <script type="text/template">
    # Today's talk
    * BookBeat case study
    * How did they get to where they are
    * iOS-specific challenges
    * My approach to solve them
    </script>
  </section>
</section>


<section>
  <section data-markdown>
    # BookBeat
    ## A startup story
  </section>

  <section data-markdown>
    # Audio & e-books
    * Stream & Download
    * Monthly fee, unlimited use
    * Soft launched late 2015
    * Real launch spring 2016
  </section>

  <section data-markdown>
    # Competitors
    * Audible
    * Storytel
    * Nextory
    * ...and many others
  </section>

  <section data-markdown>
    # The Big Picture 
    * What should we do?
    * How should we do it?
    * Name, price, design, tonality
    * Partnerships, publishers, reporting?
  </section>

  <section data-markdown>
    # Tech
    * Backend
    * Integrations
    * Api(s)
    * Applications
  </section>

  <section data-markdown>
    # Process
    * Discovery & learning driven
    * Constant changes
    * Fine-tune, change, pivot
    * Adaptability is key
  </section>

  <section data-markdown>
    # Code
    * Adaptability over architecture
    * Build it right once we know
    * Avoid premature optimization
    * (Apps) Test most important parts only
  </section>
</section>


<section>
  <section data-markdown>
    # Keeping it together
    ## How to keep your code clean
  </section>

  <section data-markdown>
    # Good practices
    * Minimize coupling
    * Minimize inheritance
    * Don't let external dependencies leak
    * Keep it simple!
  </section>

  <section data-markdown>
    # Spike & Stabilize
    * Dan North, 2011
    * Good for changing scope, pivots etc.
    * Optimize for throwawayability
    * Code should be easy to throw away
  </section>

  <section data-markdown>
    # Prototype-driven
    * Start with a prototype
    * Stabilize if proven valuable
    * Throw away if proven worthless 
    * Code MUST be easy to throw away
  </section>
</section>

<section>
  <section data-markdown>
    # But what if you fail?
    ## How do you know?
  </section>

  <section data-markdown class="image-section" data-background="{{assets}}/code-smell.gif">
    # Code-smell
  </section>

  <section data-markdown>
    <script type="text/template">
    # What is code smell?
    * Surface indication of deeper problems
    * Violate fundamental design principles
    * Usually not bugs, but can hide nasty ones
    * Bad habits, inexperience, stress
    </script>
  </section>

  <section data-markdown class="image-section" data-background="{{assets}}/code-smell-hands.gif">
    # Raise of hands
    ## Favorite code-smells?
  </section>

  <section data-markdown class="image-section light" data-background="https://miro.medium.com/v2/resize:fit:996/0*4Q2A6om9usjCX0uh.gif">
    # Duplicated code
    ## e.g. validation, formatting, business logic
  </section>

  <section data-markdown class="image-section light" data-background="https://media2.giphy.com/media/quEsMOrr3hmQ8/giphy.gif">
    # Long functions
    ## Hard to test, cyclomatic complexity
  </section>

  <section data-markdown class="image-section light" data-background="https://miro.medium.com/v2/resize:fit:782/1*kFhUH_BvhsQuoBqIy2PAcw.png">
    # Complicated code
    ## If your code needs a lot of comments, you know
  </section>

  <section data-markdown class="image-section light" data-background="{{assets}}/large-class.jpg">
    # Large classes
    ## Does a lot of stuff...that it shouldn't
  </section>

  <section data-markdown class="image-section" data-background="{{assets}}/spaghetti.jpg">
    # Spaghetti code
    ## ...or lack of obvious design
  </section>

  <section data-markdown class="image-section" data-background="{{assets}}/coupling.jpg">
    # Hard coupling
    ## A depends on B which depends on...
  </section>

  <section data-markdown class="image-section" data-background="{{assets}}/bad-habits.jpg">
    # Bad habits
    ## Unit tests disabled, no version control etc.
  </section>

  <section data-markdown>
    <script type="text/template">
    # Dangers
    * Hacking is quick at first
    * Often appreciated by management
    * New features constantly delivered 
    * But...
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    # Long-term effects
    * Rigid code, hard to change
    * Untestable code, lack of abstractions
    * Degrades over time
    </script>
  </section>
</section>


<section>
  <section data-markdown>
    # So, BookBeat?
    ## How did the MVP code look?
  </section>

  <section data-markdown class="image-section" data-background="{{assets}}/secret.gif">
  </section>

  <section data-markdown>
    <script type="text/template">
    # Good things first 
    * Build server
    * Fastlane
    * Beta testing
    * Localization
    * AND - They got a business launched
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    # Code problems
    * Generally overly-complex
    * Rigid code, hard coupling
    * Really hard to break up dependencies
    * **RestKit & CoreData everywhere**
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    # AudioPlayer 
    * 1000 lines monolith
    * Plays, streams, buffers, reports etc.
    * Spaghetti code
    * Untested, untestable
    * Depends on database entities
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    # Project problems
    * Slow build times
    * All logic in the app
    * Existing unit tests disabled
    * Can't add tests (segmentation fault 11)
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    ## How are we handling it?
    * Baby steps!
    * Break up dependencies
    * Make domain model abstract
    * Extract code into libraries
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    # CocoaPods
    * Package Manager for iOS
    * Alternatives: Carthage, Swift PM
    * ✖ CocoaPod repo
    * ✔ Private git repos + Development pods
    </script>
  </section>
  
  <section data-markdown>
    <script type="text/template">
    # Libraries - Pros
    * Can be used in multiple apps
    * Minimizes the app's responsibility
    * Faster build times → easier testing
    * Reduces coupling, forces abstraction
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    # Libraries - Cons
    * Slower app build times (not always)
    * Number of pods can pile up
    * Library versioning hell
    * Sometimes too much complexity
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    # Current State
    * BookBeat app: 10% less code
    * BBCore (core logic + utils)
    * BBAudioPlayer (audio player)
    * BBDomain (domain model + api)
    * CI & Unit Tests for each project
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    ## Remaining Challenges
    * Make domain model 100% abstract
    * Replace RestKit with Alamofire
    * Replace CoreData with Realm
    * Re-enable tests for main app
    </script>
  </section>
</section>
  

<section>

  <section data-markdown>
    # Live Coding
  </section>
</section>

<section>
  <section data-markdown>
    # Wrapping up
  </section>

  <section data-markdown>
    <script type="text/template">
    # BookBeat-specific
    * No silver bullet
    * Works great for us
    * Pods is not the only way
    * Approach depends on the app
    </script>
  </section>

  <section data-markdown>
    <script type="text/template">
    # Some advice
    * Abstract - What, not how
    * Get good practices in place early on
    * Reduce coupling (DI)
    * Write tests, at least one test
    </script>
  </section>
</section>

<section data-markdown>
  # Thank you!
  Daniel Saidi · [@danielsaidi]({{site.twitter_url}})
</section>